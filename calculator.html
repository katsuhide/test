<!DOCTYPE html> <html lang="ja">
	<head>
		<meta charset="UTF-8">
		<title>Divide Calculator</title>	
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />
		<link rel="stylesheet" href="css/calculator.css" />
		<script src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
        <script src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>
		<script>
		var num = 0;
		var currentCheckbox = '';
		var conditionNum = 0;
		var currentCondition = '';
		var currentResult = '';
		
		$(function(){
				
			// when calc button is pressed
			$('#calcBtn').click(function() {
				// calculation	
				calc();	
				// page transition
				$.mobile.changePage('#resultPage', {transition:"flip"});
				// draw result
				drawResult();
			});
					
			// when clear button is pressed
			$('#clearBtn').click(function(){
				clear();	
			})
			
			// when back button is pressed
			$('#backBtn').click(function(){
				clear();
			})
			
			// when add button is pressed
			$('#addBtn').click(function(){
				addCondition();
			})
			
		});

		// Clear all the text field
		function clear(){
			$('#amount').val('');
			$('#member').val('');
			$('#resultArea').children().remove();
			$('#additionalCondition').children().remove();
			str = '';
			currentResult = '';
			currentCondition = '';
			num = 0;
			conditionNum = 0;
		};
		
		// List add
		function addList(result){
			var res =  Math.round(result, 0);
			currentResult = currentResult + '<input type="checkbox" name="checkbox-' + num + '" id="checkbox-' + num + '"/><label for="checkbox-' + num + '">' + res + '</label>';
			num++;	
		};
		
		// drawResult
		function drawResult(){
			var str = '<fieldset data-role="controlgroup">';
			str += '<div>';
			str += currentResult ;
			str += '</div>';
			str += '</fieldset>';
			$('#resultArea').children().remove();
			$('#resultArea').html(str).trigger('create');
		};
		
		// Add the condition
		function addCondition(){
			var str = '<div class="ui-grid-a">';
			str += '<div class="ui-block-a"><label for="amount' + conditionNum + '">Charge' + conditionNum + ':</label><input type="number" name="amount' + conditionNum + '" id="amount' + conditionNum + '" value="" /></dvi></div>';
			str += '<div class="ui-block-b"><label for="amount' + conditionNum + '">Member' + conditionNum + ':</label><input type="number" name="member' + conditionNum + '" id="member' + conditionNum + '" value="" /></dvi></div>';
			str += '</div>';
			currentCondition += str;
			$('#additionalCondition').children().remove();
			$('#additionalCondition').html(currentCondition).trigger('create');
			conditionNum++;
		}
		
		// Calculation
		function calc(){
			// 追加の計算条件を格納する
			var  totalAddCharge = 0;
			var totalAddMem = 0;
			for(var i = 0; i < conditionNum; i++){
				var addMem = parseInt($('#member'+i).val());
				var addCharge = parseInt($('#amount'+i).val());
				console.log(addMem + ' : ' + addCharge);
				// 追加条件の結果を格納する
				for(var j = 0; j < addMem; j++){
					addList(addCharge);
				}	
				// 格納した金額の結果を保持
				totalAddCharge += addCharge;
				totalAddMem += addMem
			}
			console.log(totalAddMem + ' : ' + totalAddCharge);
			// 残りの金額を通常条件で分配して格納
			var balance = parseInt($('#amount').val()) - totalAddCharge;
			var otherMem = parseInt($('#member').val()) - totalAddMem;
			var unit = balance / otherMem;
			for(var i = 0; i < otherMem; i++){
				addList(unit);	
			}

		}
		
		</script>
	</head>
	
	<body>
		<!-- home page -->	
		<div data-role="page" id="home">

			<!--  header -->
			<div data-role="header" data-position="fiexd">
				<h1>Divide Calculator</h1>	
				<a href= "#home" data-icon="refresh" class="ui-btn-right" id="clearBtn" >Clear</a>
			</div>	

			<!--  content -->
			<div data-role="content">

				<div data-role="fieldcontain">
					<div id="gridArea" class="ui-grid-a">
						<div class="ui-block-a">
							<label for="amount">Charge:</label>
							<input type="number" name="amount" id="amount" value="" />
						</div>
						<div class="ui-block-b">
							<label for="member">Member:</label>
							<input type="number" name="member" id="member"  value="" />	
						</div>
					</div>
					
					<div >
						<input type="button" id="calcBtn" data-inline="true" data-icon="arrow-r"  data-iconpos="right" value="Calc..." />
						<input type="button" id="addBtn" data-inline="true" data-icon="plus"  data-iconpos="right" value="Add..." />
					</div>

				</div>
				
				<div data-role="fieldcontain" id="additionalCondition">
				</div>
					
			</div><!--  end content -->

			<!--  footer -->
			<div data-role="footer" data-postion="fixed">
				<h4></h4>
			</div>
	
		</div>

		<!-- result page -->	
		<div data-role="page" id="resultPage"  data-title="Divide Calculator (Result)">

			<!--  header -->
			<div data-role="header" data-position="fiexd">
				<a href="#home" data-icon="back" id="backBtn"  data-transition="flip">Back</a>
				<h1>Result</h1>	
			</div>	

			<!--  content -->
			<div data-role="content" id="resultArea">
			</div>

			<!--  footer -->
			<div data-role="footer" data-postion="fixed">
				<h4></h4>
			</div>
	
		</div>

	</body>
</html>